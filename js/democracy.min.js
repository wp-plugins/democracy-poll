!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return e=o.json?JSON.stringify(e):String(e),o.raw?e:encodeURIComponent(e)}function n(t,n){var a;if(o.raw)a=t;else e:{var s=t;0===s.indexOf('"')&&(s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{s=decodeURIComponent(s.replace(i," ")),a=o.json?JSON.parse(s):s;break e}catch(d){}a=void 0}return e.isFunction(n)?n(a):a}var i=/\+/g,o=e.cookie=function(i,a,s){if(void 0!==a&&!e.isFunction(a)){if(s=e.extend({},o.defaults,s),"number"==typeof s.expires){var d=s.expires,r=s.expires=new Date;r.setTime(+r+864e5*d)}return document.cookie=[o.raw?i:encodeURIComponent(i),"=",t(a),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}s=i?void 0:{};for(var d=document.cookie?document.cookie.split("; "):[],r=0,c=d.length;c>r;r++){var f,u=d[r].split("=");if(f=u.shift(),f=o.raw?f:decodeURIComponent(f),u=u.join("="),i&&i===f){s=n(u,a);break}i||void 0===(u=n(u))||(s[f]=u)}return s};o.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),function(e){"use strict";var t,n=".democracy",i=".dem-screen",o=".dem-add-answer-txt",a=e(n).attr("data-ajax-url");e.fn.demLoadingDots=function(){var e=this,n=e.is("input"),i=n?e.val():e.text();"..."==i.substring(i.length-3)?n?e.val(i.substring(0,i.length-3)):e.text(i.substring(0,i.length-3)):n?e[0].value+=".":e[0].innerHTML+=".",t=setTimeout(function(){e.demLoadingDots()},200)},e.fn.demSetLoadDots=function(){var e=this;return t=setTimeout(function(){e.demLoadingDots()},50),this},e.fn.demUnsetLoadDots=function(){return clearTimeout(t),this},e.fn.demSetLoadClass=function(){return this.closest(n).addClass("dem-loading"),this},e.fn.demUnsetLoadClass=function(){return this.closest(n).removeClass("dem-loading"),this},e.fn.demAddAnswer=function(){var t=this.first(),n=t.closest(i),a=n.find("[type=checkbox]").length>0,s=e('<input type="text" class="'+o.replace(/\./,"")+'" value="">');if(n.find("[type=radio]").each(function(){e(this).click(function(){t.fadeIn(300),e(o).remove()}),"radio"==e(this)[0].type&&(this.checked=!1)}),t.hide().parent("li").append(s),s.hide().fadeIn(300).focus(),a){var d=n.find(o);e('<span class="add-answer-txt-close">Ã—</span>').insertBefore(d).css("line-height",d.outerHeight()+"px").click(function(){var t=e(this).parent("li");t.find("input").remove(),t.find("a").fadeIn(300),e(this).remove()})}return!1},e.fn.demCollectAnsw=function(){var t=this.closest("form"),n=t.find("[type=checkbox],[type=radio],[type=text]"),i=t.find(o).val(),a=[],s=n.filter("[type=checkbox]:checked");if(s.length>0)s.each(function(){a.push(e(this).val())});else{var d=n.filter("[type=radio]:checked");d.length&&a.push(d.val())}return i&&a.push(i),a=a.join(","),a?a:""},e.fn.demSetHeight=function(t){return this.each(function(){var n=e(this);t||(t=300);var i=n.html(),o=n.clone().html(i).css({height:"auto"}).appendTo(n),a="border-box"==o.css("box-sizing")?o.outerHeight():o.height();o.remove(),n.css({opacity:0}).animate({height:a},t,function(){e(this).animate({opacity:1},1.5*t)})})},e.fn.demShake=function(){return this.each(function(){var t=e(this).css("position");for(t&&"static"!==t||e(this).css("position","relative"),t=1;2>=t;t++)e(this).animate({left:-10},50).animate({left:10},100).animate({left:0},50)})},e.fn.demDoAction=function(o){var s=this.first(),d=s.closest(n),r={dem_pid:d.attr("data-pid"),dem_act:o,action:"dem_ajax"};return"undefined"==typeof r.dem_pid?(console.log("Poll id is not defined!"),!1):"vote"!=o||(r.answer_ids=s.demCollectAnsw(),r.answer_ids)?"delVoted"!=o||confirm(s.attr("data-confirm-text"))?"newAnswer"==o?(s.demAddAnswer(),!1):(s.demSetLoadClass().demSetLoadDots(),e.post(a,r,function(e){s.demUnsetLoadClass().demUnsetLoadDots(),clearTimeout(t);var n=s.closest(i);n.html(e).demSetHeight().demSetClick()}),!1):!1:(s.demShake(),!1)},e.fn.demSetClick=function(){return this.each(function(){var t="data-dem-act";e(this).find("["+t+"]").each(function(){e(this).attr("href","#"),e(this).click(function(n){n.preventDefault(),e(this).blur().demDoAction(e(this).attr(t))})})})},e.fn.demCacheInit=function(){var t=function(t,n){var i=t.find(".dem-answers"),o=i.attr("data-voted-class"),a=i.attr("data-voted-txt"),s=n.split(/,/);e.each(s,function(n,i){t.find('[data-aid="'+i+'"]').addClass(o).attr("title",function(){return a+e(this).attr("title")})})};return this.each(function(){var o=e(this),s=o.prev(n);if(s.length||(s=o.closest(n)),!s.length)return void console.log("Main dem div not found");var d=s.find(i).first(),r=s.attr("data-pid"),c=e.cookie("demPoll_"+r),f=!("undefined"==typeof c),u=o.find(i+"-cache.vote").html(),l=o.find(i+"-cache.voted").html();if(u){var h=(f?l:u)+"<!--cache-->";if(d.html(h).demSetClick(),f&&t(d,c),!f&&1==o.attr("data-keep_logs")){var m,p=function(){clearTimeout(m)},v=function(){m=setTimeout(function(){s.hasClass("checkAnswDone")||(s.addClass("checkAnswDone"),e.post(a,{dem_pid:s.attr("data-pid"),dem_act:"getVotedIds",action:"dem_ajax"},function(e){if(e){d.html(l).demSetHeight().demSetClick(),t(d,e);var n=d.find(".dem-youarevote").first();"blockForVisitor"==e&&(d.find(".dem-revote-link").remove(),n=d.find(".dem-only-users").first()),d.prepend(n.show()),setTimeout(function(){n.slideUp("slow")},3e3)}}))},700)};s.hover(v,p),s.click(v)}d.demSetHeight()}})},e(document).ready(function(e){e(i).filter(":visible").demSetClick().demSetHeight(1);var t=e(".dem-cache-screens");t.length>0&&t.demCacheInit()})}(jQuery);