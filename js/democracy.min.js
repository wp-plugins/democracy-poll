!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return e=o.json?JSON.stringify(e):String(e),o.raw?e:encodeURIComponent(e)}function i(t,i){var a;if(o.raw)a=t;else e:{var r=t;0===r.indexOf('"')&&(r=r.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{r=decodeURIComponent(r.replace(n," ")),a=o.json?JSON.parse(r):r;break e}catch(d){}a=void 0}return e.isFunction(i)?i(a):a}var n=/\+/g,o=e.cookie=function(n,a,r){if(void 0!==a&&!e.isFunction(a)){if(r=e.extend({},o.defaults,r),"number"==typeof r.expires){var d=r.expires,s=r.expires=new Date;s.setTime(+s+864e5*d)}return document.cookie=[o.raw?n:encodeURIComponent(n),"=",t(a),r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}r=n?void 0:{};for(var d=document.cookie?document.cookie.split("; "):[],s=0,c=d.length;c>s;s++){var f,h=d[s].split("=");if(f=h.shift(),f=o.raw?f:decodeURIComponent(f),h=h.join("="),n&&n===f){r=i(h,a);break}n||void 0===(h=i(h))||(r[f]=h)}return r};o.defaults={},e.removeCookie=function(t,i){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},i,{expires:-1})),!e.cookie(t))}}),+function(e){"use strict";var t,i=".democracy",n=".dem-screen",o=".dem-add-answer-txt",a=e(i).attr("data-ajax-url"),r=e(document).find(".dem-loader").first();e.fn.demLoadingDots=function(){var e=this,i=e.is("input"),n=i?e.val():e.text();"..."==n.substring(n.length-3)?i?e.val(n.substring(0,n.length-3)):e.text(n.substring(0,n.length-3)):i?e[0].value+=".":e[0].innerHTML+=".",t=setTimeout(function(){e.demLoadingDots()},200)},e.fn.demSetLoader=function(){var e=this;return r.length?e.closest(n).append(r.clone().css("display","table")):t=setTimeout(function(){e.demLoadingDots()},50),this},e.fn.demUnsetLoader=function(){return r.length?this.closest(n).find(".dem-loader").remove():clearTimeout(t),this},e.fn.demAddAnswer=function(){var t=this.first(),i=t.closest(n),a=i.find("[type=checkbox]").length>0,r=e('<input type="text" class="'+o.replace(/\./,"")+'" value="">');if(i.find("[type=radio]").each(function(){e(this).click(function(){t.fadeIn(300),e(o).remove()}),"radio"==e(this)[0].type&&(this.checked=!1)}),t.hide().parent("li").append(r),r.hide().fadeIn(300).focus(),a){var d=i.find(o);e('<span class="dem-add-answer-close">Ã—</span>').insertBefore(d).css("line-height",d.outerHeight()+"px").click(function(){var t=e(this).parent("li");t.find("input").remove(),t.find("a").fadeIn(300),e(this).remove()})}return!1},e.fn.demCollectAnsw=function(){var t=this.closest("form"),i=t.find("[type=checkbox],[type=radio],[type=text]"),n=t.find(o).val(),a=[],r=i.filter("[type=checkbox]:checked");if(r.length>0)r.each(function(){a.push(e(this).val())});else{var d=i.filter("[type=radio]:checked");d.length&&a.push(d.val())}return n&&a.push(n),a=a.join("~"),a?a:""},e.fn.demSetHeight=function(t){return this.each(function(){var i=e(this),n=400,o=i.html(),a=i.clone().html(o).css({height:"auto"}).appendTo(i),r="border-box"==a.css("box-sizing")?a.outerHeight():a.height();a.remove(),t?i.css({height:r}):i.css({opacity:0}).animate({height:r},n,function(){e(this).animate({opacity:1},1.5*n)})})},e.fn.demShake=function(){return this.each(function(){var t=e(this).css("position");for(t&&"static"!==t||e(this).css("position","relative"),t=1;2>=t;t++)e(this).animate({left:-10},50).animate({left:10},100).animate({left:0},50)})},e.fn.demDoAction=function(t){var o=this.first(),r=o.closest(i),d={dem_pid:r.attr("data-pid"),dem_act:t,action:"dem_ajax"};return"undefined"==typeof d.dem_pid?(console.log("Poll id is not defined!"),!1):"vote"!=t||(d.answer_ids=o.demCollectAnsw(),d.answer_ids)?"delVoted"!=t||confirm(o.attr("data-confirm-text"))?"newAnswer"==t?(o.demAddAnswer(),!1):(o.demSetLoader(),e.post(a,d,function(e){o.demUnsetLoader();var t=o.closest(n);t.html(e).demSetHeight().demSetClick()}),!1):!1:(o.demShake(),!1)},e.fn.demSetClick=function(){return this.each(function(){var t="data-dem-act";e(this).find("["+t+"]").each(function(){e(this).attr("href",""),e(this).click(function(i){i.preventDefault(),e(this).blur().demDoAction(e(this).attr(t))})})})},e.fn.demCacheInit=function(){e.fn.demCacheShowNotice=function(e){var t=this.first(),i=t.find(".dem-youarevote").first();return"blockForVisitor"==e&&(t.find(".dem-revote-link").remove(),i=t.find(".dem-only-users").first()),t.prepend(i.show()),setTimeout(function(){i.slideUp("slow")},3e3),this};var t=function(t,i){var n=t.find(".dem-answers"),o=n.attr("data-voted-class"),a=n.attr("data-voted-txt"),r=i.split(/,/);e.each(r,function(i,n){t.find('[data-aid="'+n+'"]').addClass(o).attr("title",function(){return a+e(this).attr("title")})})};return this.each(function(){var o=e(this),r=o.prev(i);if(r.length||(r=o.closest(i)),!r.length)return void console.log("Main dem div not found");var d=r.find(n).first(),s=r.attr("data-pid"),c=e.cookie("demPoll_"+s),f="notVote"==c?!0:!1,h=!("undefined"==typeof c||f),l=o.find(n+"-cache.vote").html(),u=o.find(n+"-cache.voted").html();if(l){var m=l;if(h&&(m=u),d.html(m+"<!--cache-->").demSetHeight(1).demSetClick(),!f){var p=c;if(h&&t(d,p),!h&&1==o.attr("data-opt_logs")){var v,g=function(){clearTimeout(v)},k=function(){v=setTimeout(function(){if(!r.hasClass("checkAnswDone")){r.addClass("checkAnswDone");var i=r.find(".dem-link").first();i.demSetLoader(),e.post(a,{dem_pid:r.attr("data-pid"),dem_act:"getVotedIds",action:"dem_ajax"},function(e){i.demUnsetLoader(),e&&(d.html(u).demSetHeight().demSetClick(),t(d,e),d.demCacheShowNotice(e))})}},700)};r.hover(k,g),r.click(k)}}}})},e(window).load(function(){e(n).filter(":visible").demSetClick().demSetHeight(1);var t=e(".dem-cache-screens");t.length>0&&t.demCacheInit()})}(jQuery);