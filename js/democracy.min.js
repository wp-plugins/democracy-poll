!function(e){if("function"==typeof define&&define.amd)define(e);else if("object"==typeof exports)module.exports=e();else{var t=window.Cookies,n=window.Cookies=e();n.noConflict=function(){return window.Cookies=t,n}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function t(n){function i(t,o,s){var a;if(arguments.length>1){if(s=e({path:"/"},i.defaults,s),"number"==typeof s.expires){var d=new Date;d.setMilliseconds(d.getMilliseconds()+864e5*s.expires),s.expires=d}try{a=JSON.stringify(o),/^[\{\[]/.test(a)&&(o=a)}catch(c){}return o=encodeURIComponent(String(o)),o=o.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",o,s.expires&&"; expires="+s.expires.toUTCString(),s.path&&"; path="+s.path,s.domain&&"; domain="+s.domain,s.secure?"; secure":""].join("")}t||(a={});for(var r=document.cookie?document.cookie.split("; "):[],f=/(%[0-9A-Z]{2})+/g,l=0;l<r.length;l++){var h=r[l].split("="),u=h[0].replace(f,decodeURIComponent),m=h.slice(1).join("=");'"'===m.charAt(0)&&(m=m.slice(1,-1));try{if(m=n&&n(m,u)||m.replace(f,decodeURIComponent),this.json)try{m=JSON.parse(m)}catch(c){}if(t===u){a=m;break}t||(a[u]=m)}catch(c){}}return a}return i.get=i.set=i,i.getJSON=function(){return i.apply({json:!0},[].slice.call(arguments))},i.defaults={},i.remove=function(t,n){i(t,"",e(n,{expires:-1}))},i.withConverter=t,i}return t()}),+function(e){"use strict";e(window).load(function(){e(i).filter(":visible").demInitActions(1),d.maxAnswLimit();var t=e(".dem-cache-screens");t.length>0&&t.demCacheInit()});var t,n=".democracy",i=".dem-screen",o=".dem-add-answer-txt",s=e(n).data("ajax-url"),a=e(".dem-loader").first(),d={};e.fn.demLoadingDots=function(){var e=this,n=e.is("input"),i=n?e.val():e.text();"..."==i.substring(i.length-3)?n?e.val(i.substring(0,i.length-3)):e.text(i.substring(0,i.length-3)):n?e[0].value+=".":e[0].innerHTML+=".",t=setTimeout(function(){e.demLoadingDots()},200)},e.fn.demSetLoader=function(){var e=this;return a.length?e.closest(i).append(a.clone().css("display","table")):t=setTimeout(function(){e.demLoadingDots()},50),this},e.fn.demUnsetLoader=function(){return a.length?this.closest(i).find(".dem-loader").remove():clearTimeout(t),this},e.fn.demAddAnswer=function(){var t=this.first(),n=t.closest(i),s=n.find("[type=checkbox]").length>0,a=e('<input type="text" class="'+o.replace(/\./,"")+'" value="">');if(n.find(".dem-vote-button").show(),n.find("[type=radio]").each(function(){e(this).click(function(){t.fadeIn(300),e(o).remove()}),"radio"==e(this)[0].type&&(this.checked=!1)}),t.hide().parent("li").append(a),a.hide().fadeIn(300).focus(),s){var d=n.find(o);e('<span class="dem-add-answer-close">Ã—</span>').insertBefore(d).css("line-height",d.outerHeight()+"px").click(function(){var t=e(this).parent("li");t.find("input").remove(),t.find("a").fadeIn(300),e(this).remove()})}return!1},e.fn.demCollectAnsw=function(){var t=this.closest("form"),n=t.find("[type=checkbox],[type=radio],[type=text]"),i=t.find(o).val(),s=[],a=n.filter("[type=checkbox]:checked");if(a.length>0)a.each(function(){s.push(e(this).val())});else{var d=n.filter("[type=radio]:checked");d.length&&s.push(d.val())}return i&&s.push(i),s=s.join("~"),s?s:""},e.fn.demDoAction=function(t){var o=this.first(),a=o.closest(n),c={dem_pid:a.data("pid"),dem_act:t,action:"dem_ajax"};return"undefined"==typeof c.dem_pid?(console.log("Poll id is not defined!"),!1):"vote"!=t||(c.answer_ids=o.demCollectAnsw(),c.answer_ids)?"delVoted"!=t||confirm(o.data("confirm-text"))?"newAnswer"==t?(o.demAddAnswer(),!1):(o.demSetLoader(),e.post(s,c,function(e){o.demUnsetLoader();var t=o.closest(i);t.html(e).demInitActions()}),!1):!1:(d.demShake(o),!1)},e.fn.demInitActions=function(t){return this.each(function(){var n="data-dem-act";e(this).find("["+n+"]").each(function(){e(this).attr("href",""),e(this).click(function(t){t.preventDefault(),e(this).blur().demDoAction(e(this).attr(n))})});var i=!!e(this).find("input[type=radio][data-dem-act=vote]").first().length;i&&e(this).find(".dem-vote-button").hide(),d.setHeight(e(this),t)})},e.fn.demCacheShowNotice=function(e){var t=this.first(),n=t.find(".dem-youarevote").first();return"blockForVisitor"==e&&(t.find(".dem-revote-button").remove(),n=t.find(".dem-only-users").first()),t.prepend(n.show()),setTimeout(function(){n.slideUp("slow")},1e4),this},d.cacheSetAnswrs=function(t,n){var i=n.split(/,/);if(t.hasClass("voted")){var o=t.find(".dem-answers"),s=o.data("voted-class"),a=o.data("voted-txt");e.each(i,function(n,i){t.find('[data-aid="'+i+'"]').addClass(s).attr("title",function(){return a+e(this).attr("title")})}),t.find(".dem-vote-link").hide()}else{var d=t.find("[data-aid]"),c=t.find(".dem-voted-button");e.each(i,function(e,t){d.filter('[data-aid="'+t+'"]').find("input").prop("checked","checked")}),d.find("input").prop("disabled","disabled"),t.find('[data-dem-act="vote"]').hide(),c.length?c.show():(t.find('input[value="vote"]').remove(),t.find(".dem-revote-button-wrap").show())}},e.fn.demCacheInit=function(){return this.each(function(){var t=e(this),o=t.prev(n);if(o.length||(o=t.closest(n)),!o.length)return void console.log("Main dem div not found");var a=o.find(i).first(),c=o.data("pid"),r=Cookies.get("demPoll_"+c),f="notVote"==r?!0:!1,l=!("undefined"==typeof r||f),h=t.find(i+"-cache.vote").html(),u=t.find(i+"-cache.voted").html();if(h){var m=l&&u;if(a.html((m?u:h)+"<!--cache-->").removeClass("vote voted").addClass(m?"voted":"vote"),l&&d.cacheSetAnswrs(a,r),a.demInitActions(1),!f&&!l&&1==t.data("opt_logs")){var p,v=function(){clearTimeout(p)},g=function(){p=setTimeout(function(){if(!o.hasClass("checkAnswDone")){o.addClass("checkAnswDone");var t=o.find(".dem-link").first();t.demSetLoader(),e.post(s,{dem_pid:o.data("pid"),dem_act:"getVotedIds",action:"dem_ajax"},function(e){t.demUnsetLoader(),e&&(a.html(u),d.cacheSetAnswrs(a,e),a.demInitActions(),a.demCacheShowNotice(e))})}},700)};o.hover(g,v),o.click(g)}}})},d.setHeight=function(t,n){var i=400,o=t.html(),s=t.clone().html(o).css({height:"auto"}).appendTo(t),a="border-box"==s.css("box-sizing")?s.outerHeight():s.height();s.remove(),n?t.css({height:a}):t.css({opacity:0}).animate({height:a},i,function(){e(this).animate({opacity:1},1.5*i)})},d.maxAnswLimit=function(){var t="data-max__answs";e("["+t+"]").on("change","[type=checkbox]",function(){var n=e(this).closest("["+t+"]").attr(t),o=e(this).closest(i).find("[type=checkbox]"),s=o.filter(":checked").length;s>=n?o.filter(":not(:checked)").each(function(){e(this).prop("disabled","disabled").closest("li").addClass("dem-disabled")}):o.each(function(){e(this).removeProp("disabled").closest("li").removeClass("dem-disabled")})})},d.demShake=function(e){var t=e.css("position");for(t&&"static"!==t||e.css("position","relative"),t=1;2>=t;t++)e.animate({left:-10},50).animate({left:10},100).animate({left:0},50)}}(jQuery);